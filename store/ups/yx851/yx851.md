## Модуль для контроля процесса зарядки 12 в батареи на реле YX851

![i](logo.jpg)

Купил я этот модуль с надеждой сделать из него бесперебойник для домашней электроники. В этот модуль встроена микросхема NE555, на основе которой реализована функция контроля напряжения. На картинках продавец предлагает использовать данную фичу что бы управлять зарядным устройством непосредственно по линии 220 вольт. 

![i](220v_control.jpg)

Уровни срабатывания можно регулировать двумя крутилками. Принцип действия контроллера следующий. При достижении на аккумуляторе уровня Vbatmin микросхема включает реле. Через реле подключено зарядное устройство. После включения реле оно начинает зарядку батареи. Когда напряжение на батарее достигнет напряжения Vbatmax, то реле отключится и зарядка прекратится. Подзарядка по новой включится только когда напряжение опять упадет до уровня Vbatmin. То есть обеспечивается гистерезис, что бы не было циклических переключений

Я задал такие уровни напряжений. 
Vbatmin = 12 в
Vbat max = 13.8 в
То есть когда аккум разрядится на половину, то включится дозарядка. В описании данного реле заявлена защита от переразряда. Это фейковая защита. Сами подумайте, если аккум переразрядился, то с него надо бы снять всю нагрузку, а этот модуль подает дополнительную в виде релюшки

В этой плате есть еще одно реле, которое реализует функцию переключения между блоком питания и батареей. Что бы нагрузка всегда была запитана. Получается что то типа ИБП. Но не без недостатков. При переключении реле проходит около секунды. Роутер к такому UPS не подключишь, а вот для освещения нормас. 

Внешний блок питания подключается к нормально разомкнутому контакту реле, а батарея к нормально замкнутому. Катушка запитывается напрямую от внешнего БП. Когда сетевое напряжение пропадает и БП перестает подавать 12 в на катушку, то общий контакт релюшки переключается на батарею. Так реализована функция автоматического переключения. Тупо релюшка.

Так вот. Защита от переразряда. Если нет напряжения и нагрузка питается от батареи. То батарея, логично предположить разряжается. При достижении порога Vbatmin включится реле для зарядки. И ничего не произойдет (220 то нету...). Нагрузка продолжит разряжать батарею пока та не разрядится в ноль...

Окай. А что если через релюшку для зарядки подключить не зарядку, а нагрузку? Тогда при достижении напряжения срабатывания релюшка включится и ... подключит нагрузку.... wtf? китайцы забыли развести нормально замкнутый контакт релюшки. Хотя на плате он есть, в отличии от некоторых других модулей, значит можно припаяться

![]()

Теперь при сработке защиты будет включено реле и нагрузка отключится. Уже лучше, но есть пару недостатков
- при низком напряжении батареи нагрузка не сможет быть запитана и от сетевого БП тоже. Релюха ведь разьединила линию питания. Так будет продолжаться пока напряжение батареи не восстановится
- при и так разряженной батарее мы добиваем ее, подключая катушку реле. Да, пусть это всего 100мА, но все же.. Однажды напряжение аккумулятора при таком токе опустится ниже напряжения удержания реле и оно подключит нагрузку обратно. Так аккумулятор и сдохнет. Короче защиты от переразряда не предусмотрено (позже мы это исправим)


![схема перерисованная из платы yx851]()



**переделка**

Что я бы поменял в модуле? Ну изначально стоит сказать что это очень плохой модуль, плохо настраивается, неправильно работает (даже если следовать предусмотренному сценарию). Поэтому я бы порекомендовал его не покупать. Но если уж он уже есть в наличии, то прям руки чешутся его переделать
- вместо включения зарядного устройства надо сделать отключение батареи при разряде. Прячем через нормально разомкнутый контакт. То есть что бы при сработке защиты с аккумулятора снять любую нагрузку
- на вход реле, которое переключает источники подать напряжение не напрямую от аккумулятора, а через защиту (см. предыдущий пункт)

Фронт работ понятен. Работы много, будем резать дороги, паять новые. И главное обдумывать сценарий, как это должно работать. 
В первую очередь я настроил сработку реле "Charger" по сценарию как было задумано китайцами. Это оказалось очень непросто сделать. Подстроечники многооборотные и их нужно крутнуть примерно 50 раз что бы добраться от одного края к другому. Найти нужное положение очень сложно. Тем более есть крутилки зависят одна от другой. Инженеры которые делали этот модуль просто сэкономили пару SMD-резисторов, не устранив возможность выставлять напряжения сработки в полном диапазоне от 0 до Uвх. 

В общем настроил что бы реле которое помечено как Charger включалось при нужном мне напряжении. Далее попытался приспособить это реле для защиты аккумулятора. Прикол в том, что NE555 подает высокий уровень при сработке нижнего уровня напряжения. То есть реле включается. Для защиты это не подходит, о чем я уже писал выше. Нужно этот сигнал инвертировать. Сначала хотел допаять на плату один транзистор, но потом понял что будет достаточно второй вывод подключить к плюсу питания вместо земли. Проводок припаять легче, чем транзистор. Китайцы кажется специально сделали линию земли максимально тонкой, видимо что бы мне было легче резать

![фотка где разрезать]()
![и где кинуть перемычку]()

Теперь работа модуля инвертирована до наоборот:
- когда напряжение батареи нормальное, то реле запитано и нагрузка может быть запитана от батареи. реле при этом потребляет энергию 100мА. Но это не страшно
- Когда напряжение упало ниже критического, то реле отпускается. Теперь ничто не сможет вытянуть соки из аккумулятора. Ну разве что сам таймер 555. Потребление схемы с выключенными релюхами составляет около 15мА
На общий вход реле припаял выход от батареи проводком. А нормально разомкнутый контакт припаял реле переключения напряжения. Нормально разомкнутый, это тот, на котором есть напряжение только в рабочем диапазоне напряжений

На вход реле переключающего источники сейчас подключен аккумулятор напрямую. А надо бы с выхода защиты. Режем дорогу. Итого получается два реза и три перемычки. 

![фото с перемычками]()

Регулировка крутилками теперь тоже поменяла свое значение. Крутилка V11 теперь отвечает за напряжение батареи при котором отключится выходное реле. А крутилка V12 регулирует напряжение, при котором защита снимется. Таким образом обеспечивается гистерезис напряжений. Он нужен что бы не было постоянных миганий из-за восстановления напряжения батареи при отключении нагрузки


![фото с новыми обозначениями "Откл" и "Восст" на модуле]()


Стои тзаметить что в китайских интернет магазинах также продается более элегантный модуль, собранный на LM358. Он дешевле, не требует переделки. Возможно о нем тоже выйдет заметка, так как в нем применена очень интересная технология обеспечения гистерезиса - положительная обратная связь. И мне не терпится разобрать еще и его

![фотка модуля защиты свинцово-кислотной батареи на LM358]()
