---
date: 2021-11-02T11:58:59+02:00
modified: 2021-11-03T11:59:46+02:00
title: Генератор локальных ссылок для onedrive
tags: software
---

## Утилита для создания локальных ссылок на файлы в onedrive

Представляет из себя BAT-файл, который помещается в папку ```shell:sendto```. После передачи файла программе - она копирует в буфер адрес к этому файлу в виде ```%onedrive%\Folder\Subfolder\file.txt```. 

Интерес в том, что она автоматически заменяет путь к папке onedrive ```C:\\Users\Admin\OneDrive``` на локальной машине на переменную среды ```%onedrive%```. Это позволит открывать такую ссылку на любом другом компе, который синхронизируется с тем же аккаунтом или имеет одинаковые расшаренные папки

## Листинг кода

```
@chcp 1251
@echo off
rem Команды выше включают поддержку русских букв в кодировке windows-1251 и отключают вывод служебной информации в окне консоли
echo.

rem Дальше принимаем переданный скрипту путь в переменную
set str=%~1
echo Передан параметр: 
echo %str%

rem TODO: Проверить что параметр не пустой 
rem TODO: Проверить что передан путь с вандрайва 
rem TODO: Проверить на наличие этого bat-файла в меню "отправить" (shell:sendto). Путь: %AppData%\Microsoft\Windows\SendTo 

rem Удаляем часть пути, который уникален для каждой машины
call set str=%%str:%onedrive%=%%

rem Создаем НОВУЮ переменную с названием переменной в которой хранится путь к папке onedrive. 
rem Иначе копирование не сработает и переменная (onedrive) будет раскрываться до попадания в буфер 
Set "twodrive=%%onedrive%%"

rem Приклеиваем в начало пути переменную onedrive без её раскрытия
set bufer=%%twodrive%%%str%

rem Копируем этот путь в буфер обмена
echo %bufer% | clip

rem Выводим результат (почти правильный). Вместо onedrive будет twodrive. Так и задумано. В буфере все раскроется правильно
echo.
echo В буфер скопировано:
echo %bufer%
echo.

rem Делаем проверку. ()
set /P pass=Проверка. Нажми Ctrl+V: 
TIMEOUT /T 8
exit
```
