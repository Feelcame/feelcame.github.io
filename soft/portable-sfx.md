---
title: Универсальный инсталятор для програм (sfx)
date: 2021-11-11T11:11:11+02:00
---

можно воспользоваться специальными программами для создания инсталляторов, их перечень будет ниже. Но мне лично удобнее пользоваться обычным арховатором, по крайней мере для портативных програм
- Nullsoft Install Sastem
- Inno Setup

## Сценарий SFX для распаковки Portable программ

С этим сценарием для WinRar програма распакуетя в папку ```C:\soft```.  
Также создадутся ярлыки на распакованную папку в меню "Пуск"

Как по мне очень удобно. Использую его для программ в канале [@FeelSoft](https://t.me/feelsoft)

## Сам сценарий 

<details markdown="1"><summary markdown="0">Версия 1.0</summary>

```
;Расположенный ниже комментарий содержит команды SFX-сценария.
;Желательно использовать WinRar v6
;Поместить все файлы программы в одну папку с названеием программы
;Правый клик по ней — добавить в архив
;Поставить галочку "Создать SFX архив"
;Изменить название выходного файла, добавив в конец номер версии. 
;В этом документе, который сейчас читаешь, тоже добавить номер версии в поле "Title"
;Через Ctrl+H заменить в тексте старое название программы на новое. Оно встречается четыре раза
;Скопировать получившийся сценарий и вставить его на вкладке "Комментарий"

Path=%SYSTEMDRIVE%\!SOFT
SavePath
Setup="BOOTICE"
Overwrite=1
Title=BOOTICE v1.3.4.0
Text
{
<b>Распаковка с такими параметрами:</b><br>
- Перезапись файлов без запросов.<br>
- Создание ярлыков в папке "Пуск"<br>
- Автооткрытие распакованной папки<br>
- Запомнить выбранный путь установки<br>
<br>
Если не согласен, можешь просто распаковать программу как архив, или не использовать ее вовсе
}
Shortcut=P, "./BOOTICE/", "# Portables", "Папка программы", BOOTICE, ""
Shortcut=P, "./", "# Portables", "Открыть место хранения файлов", "# Папка на диске", ""
Shortcut=P, "%AppData%\Microsoft\Windows\Start Menu\Programs\# Portables", "# Portables", "", "# Папка в пуске", ""
```
</details>


<details markdown="1"><summary markdown="0">Версия 2.0</summary>

```
;Инициализировать создание архива
;Добавить версию в конец имени создаваемого файла
;Поставить галку "Создать SFX"
;Установить пароль "123"
;На вкладке "Комментарий" вставить сценарий ниже
;Заменить в нем название программы в двух местах

Path=%SYSTEMDRIVE%\soft\WizTree\
SavePath
Setup=.\
Title=Установка...
Text
{
<b>Желаете продолжить?</b><br>
Что-бы узнать пароль, решите задачку: <br>
120+3=?
}
Shortcut=P, ".\", , , "WizTree", 
```
</details>


## Распаковка инсталлятора
Когда программа распространяется в виде набора файлов, не всегда удобно делиться инсталлятором. Поэтому я упаковываю такие проги в один sfx-архив. WinRAR может взять на себя функцию мониторинга за процессом установки. Но я все-равно сделал дополнительный скрипт-прокладку. Он запускаясь создает большое черное окно, так я могу понять что инсталлятор начал запускаться (иногда это важно). И что установка еще продолжается. 

Также этот скрипт определяет какой разрядности система. В зависимости от этого он может запустить для установки файл нужной разрядности. Названия файлов надо прописывать вручную (пока что это лучшее что я смог придумать). 


<details markdown="1"><summary markdown="0">install.cmd</summary>

```
@echo off
@chcp 1251 > nul
title Installing...
cd /d %~dp0
cd
echo Ожидаю завершения установки...
if defined PROCESSOR_ARCHITEW6432 (set arch=64) else If "%PROCESSOR_ARCHITECTURE%"=="AMD64" (set arch=64)
if %arch%==64 (
	echo Версия: 64bit
	start "" /wait "winrar-x64-6.11ru.exe"
) else (
	echo Версия: 32bit
	start "" /wait "winrar-x32-6.11ru.exe"
)
exit
```

</details>


<details markdown="1"><summary markdown="0">комментарий sfx-архива</summary>

```
;Расположенный ниже комментарий содержит команды SFX-сценария
Setup=install.bat
TempMode="Что-бы продолжить реши задачку:\n  66+57=?","Распковка..."
Silent=1
Title=WinRAR 6.11
```
</details>


Задачка здесь нужна что-бы сообщить пользователю пароль от архива. Я иногда загружаю файлы на вандрайв и уже устал от ложных срабатываних их антивируса. Поэтому пароль. Если пароля не будет, поле ввода не появится.

Строка `Silent=1` означает что архив распакуется без окна прогресса. Значение `2` - пропустить начальное окно. `0` - показывать все
