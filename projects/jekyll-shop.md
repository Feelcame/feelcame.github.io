---
title: Jekyll-Shop. Магазин на статике
date: 2021-10-03T11:58:59+02:00
modified: 2021-11-03T11:59:46+02:00
tags: soft
---

[смотреть демо](/shop/index.md)

- toc
{: toc }

Возможно ли сделать магазин на Jekyll?

Да, это статика. Для каталога товаров этого достаточно. Дальше будет работать сервис процессинга

## Как хранить базу
**Для каждого товара своя страница в папке ```/product/```**.  
Категории задаются как тег в заголовке. Там же указывается цена, наличие

**Карточки товаров в markdown-формате распределены по дереву категорий**.  
Категории в виде дерева папок. Нет возможности задавать несколько категорий одному товару. Хотя через теги тоже можно. у всех товаров будет отличаться формат URL-адреса.

**Datafiles в формате CSV или другом**.  
Парсинг при обновлении этого файла. В дереве сайта будут только категории, которые заполняются вручную.  
```
id; Наличие; Цена в у.е; Название; Категории через пробел; Описание или ссылка.md для инклюда; Ссылки на фото через пробел; 
1; 10; 100; Nokia 1101 Тестовый товар; Телефоны Аксессуары; Самый продаваемый в истории телефон; {{id}}-1.png {{id}}-2.png;
+1; 0; 200; Nokia 1110; Телефоны; Чуть менее популярный телефон; {{id}}-1.png {{id}}-2.png;
+1; 0; 0; Nokia 5130 Express Music; Телефоны; Nokia-5130-c2.md; {{id}}-1.png {{id}}-2.png;
```


## Корзина
При добавлении товара в корзину - данные о нем сохраняются в куки бразузера. При оформлении заказа данные из куки выводятся на экран. Джаваскриптом подсчитывается сумма. После подтверждения генерируется номер заказа - набор случайных букв и цифр, так чтобы этот набор был уникальным, тоже запоминается в куки.

**полезные ссылки**
- [Хранение данных в LocalStorage](https://learn.javascript.ru/localstorage)
- [mozilla. Работа с файлами в js](https://developer.mozilla.org/ru/docs/Learn/Getting_started_with_the_web/Dealing_with_files)
- [habr. Работа с файлами в JavaScript](https://habr.com/ru/post/511742/)
- [Парсим CSV непосредственно с помощью JavaScript](https://ruseller.com/lessons.php?rub=32&id=2070)

## Доставка
Выставляется форма с предзаполненными данными: уникальное время заказа, список товаров, сумма. Поля заблокированы и не редактируются.
Дополнительно требуется ввести данные для доставки (имя, телефон, адрес и метод доставки) и способ оплаты.  

В самом конце, когда все правильно заполнено, нужно нажать кнопку "подтвердить и отправить".

После подтверждения - форма отправляется менеджеру на обработку. Выводится сообщение, что заказ получен и предлагается оплатить покупку. В сообщении указывается что заказ будет отправлен только после полной оплаты, а также номерзаказа необходимый для идентификации пользователя.

**Методы доставки:**
- Через почу
- Курьерская служба
- Самовывоз

## Безопасность данных
Вместо номера заказа - хэш сумма crc-32. Ею же будет подтверждаться правильность введенных данных, не испортились ли данные при пересылке. 

Для радужной безопасности можно дополнительно шифровать данные публичным ключем, от зашифрованного сообщения брать хэш и прикладывать его как отдельное поле в сообщении. Так можно подтвердить, что сообщение отправляется именно тому получателю, чей открытый ключ используется. Проверить это можно повторив ту же процедуру на стороне получателя.

## Передача данных формы
Доставка формы - это целая история для статического сайта. Можно использовать как сторонние серисы типа google forms или даже тупо через mailto попросить клиента самому отправить письмо. Можно, например, принимать данные через телеграм-бота. Хотя если есть возможность поднять бота, то наверное магаз на каком нибудь опенкарт будет эффективнее :)

- Кастомный дизайн гуглоформ <https://blog.webjeda.com/google-form-customize/>
- <https://webjeda.com/blog/google-pre-filled-forms>


## Оплата
Для оплаты нужно еще раз вручную выбрать метод оплаты кликнув на одну из ссылок, в которые заранее скриптами был подставлен уникальный номер заказа и сумма. Ссылка перекидывает на сайт процессинга. Он выведет сообщение о статусе оплаты: удалась или провалилась. Процессинг обрабатывает платеж и переводит деньги на счет продавца.  

Менеджер сверяет номер и сумму заказа полученный в письме с номером и суммой переведенные на счет через процессинговый сервис.
Затем, если все четко, он связывается с клиентом и сообщает трекинг-номер посылки или приглашает прийти забрать лично в точке выдачи.

**Методы оплаты:**
1. Наличными при получении (только самовывоз)
2. Картой на сайте процессинга
3. Перевод на карту. Обязательно указать номер заказа
4. Безналичный рассчет. Для компаний

## Регистрация
Регистрации нету. Максимум можно запомнить в куках данные для доставки. Там же хранится история покупок. Посмотреть сохраненные данные можно на специальной странице сайта. Данные из нее исчезают при смене браузера или очистке кэша.

Желательно сохранять уникальное имя страницы товара в куках, что бы список товаров можно было вывести ссылками. Именно поэтому мне больше нравится идея хранить все товары в одной папке - они просто не смогут пересекться между собой. О святой javascript, помоги мне разгрести то что я заварил!

## Обработка заказов
Тут уже зависит от фантазии продавца. Можно вручную обработывать - это для небольших количеств.  
Можно вести CRM и через нее все пробивать, но тогда зачем нужен статический сайт?

Если база товаров хранится как CSV, то скорее всего он генерируется из XLSX. Моя идея в том что бы письмо с заказом получала программа, которая стоит на компе у менеджера, парсила его и просила человека подтвердить правильность. После этого она сможет внести изменения в таблицу Excell из которого сгенерируется CSV и обновляется статический сайт.

После внесенных изменений в таблице - печатается товарная накладная. Она передается на склад, где комплектуется заказ и происходит отправка или выдача товара.



## Мой велосипед. Уведомления о новых заказах
Самое сложное будет найти сервис который сможет нормально отправлять формы и при этом будет позволять их редактировать скриптами. Но если все же письмо было отправлено...

В почтовике автоматически сортируем почту и новые заказы перемещаем в папку "Новые заказы". Дополнительно пересылаем их на Gmail, который настроен присылать оповещения на телеграм. Так мы не пропустим новых заказов. А те что еще не обработаны будут отмечены как непрочитанное письмо в почте.





## Поиск по сайту
Я вижу два варианта. 

Первый: генерить отдельную страницу со списком всех товаров на ней и через Ctrl+F искать что надо. 

Второй: Делать такую же страницу, но обрабатывать ее через джаваскрипт и выводить результаты в виде выпадающего меню, это более привычный вариант

## Полезные ссылки

- <https://learn.javascript.ru/localstorage>
- [Snipcart](https://snipcart.com/) - добавь функцию магазина на любой сайт
- [Trolley](https://trolley.link/) - еще один сервис магазинов
- [MemberSpace](https://www.memberspace.com/integrations/jekyll-membership/): Add memberships and paywall functionality to a Jekyll site
- Что рекомендуют разработчики Jekyll <https://jekyllrb.com/resources/>
- Репозиторий <https://github.com/snipcart/snipcart-jekyll>
- <https://jekyllthemes.io/resources/jekyll-e-commerce-solutions>
- Архивная статья по [настройке тем под snipcart](https://webcache.googleusercontent.com/search?q=cache:sNuAm3t-6QYJ:https://snipcart.com/blog/jekyll-ecommerce-tutorial+&cd=1&hl=ru&ct=clnk&gl=ua)
- <https://github.com/jekyll-store>
- <https://github.com/mikesprague/vuejs-shopping-cart>
- <https://github.com/wsdo/shop-static>
- Adding E-Commerce to a Jekyll site <https://stackoverflow.com/questions/23447431/adding-e-commerce-to-a-jekyll-site>
- Идеальный интернет-магазин <http://shpargalkablog.ru/2012/06/internet-magazin.html>

## Готовые скрипты

- <https://blog.webjeda.com/free-static-ecommerce-website/>
- <https://codepen.io/Dimasion/pen/oBoqBM>
- <https://blog.webjeda.com/svelte-ecommerce-shopping-cart/>
- <https://webjeda.com/blog/google-pre-filled-forms#>

## Твой фидбек
Что думаешь про такую телегу? Стоит ли этот конь съеденого им сена? Напиши комментарий!
